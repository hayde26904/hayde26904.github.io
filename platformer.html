<html>
<body>
	<canvas id='canvas'></canvas>
	<style>
		canvas {

			position: absolute;
			top: 0px;
			left: 0px;

		}
	</style>
	<script>
		var stage = document.getElementById('canvas').getContext('2d');
		stage.canvas.width = window.innerWidth;
		stage.canvas.height = window.innerHeight;

		var holdingdir = false;
		var holdingdir2 = false;

		var pressingakey = false;
		var pressingakey2 = false;

		//var playerDirection = 1;

		var bulletCooldownTime = 20;
		var bulletCooldown = bulletCooldownTime;


		var restarting = false;


		function bulletConstructor(x,y,dir,target){

			this.x = x;
			this.y = y;

			this.spd = 10;

			this.dir = dir;

			this.xv = this.spd*this.dir;

			this.w = 20;
			this.h = 5;

			this.target = target;


			this.draw = function(){

				stage.fillStyle = 'black';
				stage.fillRect(this.x,this.y,this.w,this.h);

			}

			this.update = function(){

				this.x+=this.xv;

			}

			this.collision = function(obj){

  				if (
    				this.x < obj.x + obj.w &&
   					this.x + this.w > obj.x &&
    				this.y < obj.y + obj.h &&
    				this.h + this.y > obj.y
  				) {
    				return obj;
  				} else {
    				return false;
  				}

			}


		}

		function playerConstructor(name,color){

			this.x = 100+Math.random()*800;
			this.y = 0;

			this.w = 50;
			this.h = 50;

			this.health = 100;

			this.gravspd = 0.1;
			this.grav = 0;

			this.xv = 0;
			this.yv = 0;

			//this.kxv = 0;
			//this.kyv = 0;

			this.spd = 3;

			this.bulletcooldowntime = 20;
			this.bulletcooldown = this.bulletcooldowntime;

			this.name = name;

			this.jumpSpd = -7;

			this.touchingground = false;
			this.jumping = false;

			this.xslip = 0.6;

			this.gunx = this.x+this.w;
			this.guny = this.y+this.h/4;

			this.holdingdir = false;

			this.dir = 1;

			this.color = color;

			this.ammo = 10;

			this.reloading = false;

			this.draw = function(){

				stage.fillStyle = this.color;
				stage.fillRect(this.x, this.y, this.w, this.h);
				stage.fillStyle = 'black';
				if(this.dir == 1){

					this.gunx = this.x+this.w;
					this.guny = this.y+this.h/4;

					stage.fillRect(this.gunx,this.guny, 20, 10);

				} else if(this.dir == -1){

					this.gunx = this.x-20;
					this.guny = this.y+this.h/4;

					stage.fillRect(this.gunx,this.guny,20,10);

				}

			}

			this.update = function(){
				if(!this.touchingground || this.jumping){
					this.grav+=this.gravspd;
					this.yv=this.grav;
				} else {

					this.grav = 0;
					this.yv = 0;

				}


				this.x+=this.xv;
				this.y+=this.yv;

				if(this.grav>=7){this.grav = 7;}

				if(this.xv < 0 && !this.holdingdir){

					this.xv+=0.07;

				} else if(this.xv > 0 && !this.holdingdir){

					this.xv-=0.07;

				}

			}

			this.platformCollision = function(plat){

				if(this.x >= plat.x && this.x+this.w/2 <= plat.x+plat.w && this.y+this.h >= plat.y && this.y+this.h <= plat.y+10 && this.x+this.w >= plat.x && this.yv >= 0){
					return true;
				} else {return false;}

			}

			this.playerbounce = function(obj){

				if(this.x+this.w/2 > obj.x && this.x+this.w/2 < obj.x+obj.w && this.y+this.h > obj.y && this.y+this.h < obj.y+15 && obj.touchingground == true && this.yv > 0){

					return true;

				} else {

					return false;

				}


			}


		}

		function platformConstructor(x,y,w,h,c){
			this.x = x;
			this.y = y;
			this.w = w;
			this.h = h;
			this.c = c;

			this.draw = function(){

				stage.fillStyle = this.c;
				stage.fillRect(this.x, this.y, this.w, this.h);
				stage.fillStyle = 'black';

			}


		}

		var player = new playerConstructor('player','red');
		var player2 = new playerConstructor('player2','green');

		/*var platform = new platformConstructor(300,600,600,40,'blue');
		var platform2 = new platformConstructor(100,400,600,40,'blue');
		var platform3 = new platformConstructor(800, 400, 600, 40, 'blue');*/

		var platforms = [new platformConstructor(300,600,400,20,'blue'),new platformConstructor(600, 400, 600, 20, 'blue'), new platformConstructor(100,400,350,20,'blue'), new platformConstructor(800, 200,200,20,'blue')];
		//new platformConstructor(100,400,600,40,'blue')

		var bullets = [];

		//var platform = new platformConstructor(300,600,600,40,'blue');

		function update(){
			stage.clearRect(0,0,stage.canvas.width, stage.canvas.height);
			player.draw();
			player.update();

			player2.draw();
			player2.update();

			stage.fillStyle = 'grey';
			stage.fillRect(50,50,300,10);
			stage.fillStyle = 'red';
			stage.fillRect(50,50,player.health*3,10);

			stage.fillStyle = 'grey';
			stage.fillRect(stage.canvas.width-350,50,300,10);
			stage.fillStyle = 'green';
			stage.fillRect(stage.canvas.width-350,50,player2.health*3,10);

			//stage.fillText('p1: '+player.health+'  p2: '+player2.health, 100, 100);

			if(!player.holdingdir && player.xv < 1){

				player.xv = 0;

			}

			if(!player2.holdingdir && player2.xv < 1){

				player2.xv = 0;

			}

			//console.log('p1: '+player.health+'  p2: '+player2.health);
			stage.fillStyle = 'black';
			stage.font = '30px Arial';
			stage.fillText('Ammo: '+player.ammo, 50 , 100);

			stage.fillText('Ammo: '+player2.ammo, stage.canvas.width-190, 100);

			if(player.reloading){

				stage.fillText('Reloading...',50,150);

			}

			if(player2.reloading){

				stage.fillText('Reloading...',stage.canvas.width-190,150);

			}

			stage.font = '100px Arial';

			if(player.health <= 0){

				stage.fillStyle = 'green';
				stage.fillText('Green Wins!', stage.canvas.width/3.5, 100);
				restarting = true;
				setTimeout(restartGame, 2000);

			} else if(player2.health <= 0){

				stage.fillStyle = 'red';
				stage.fillText('Red Wins!', stage.canvas.width/3.5, 100);
				restarting = true;
				setTimeout(restartGame, 2000);

			}

			if(player.ammo == 0){

				player.reloading = true;

				setTimeout(function(){
					player.ammo = 10;
					player.reloading = false

				}, 1000);

			}

			if(player2.ammo == 0){

				player2.reloading = true;

				setTimeout(function(){
					player2.ammo = 10;
					player2.reloading = false

				}, 1000);

			}

			if(player.x > stage.canvas.width){

				player.x = -player.w;

			} else if(player.x+player.w < 0){

				player.x = stage.canvas.width;

			}

			if(player2.x > stage.canvas.width){

				player2.x = -player2.w;

			} else if(player2.x+player2.w < 0){

				player2.x = stage.canvas.width;

			}

			player.bulletcooldown--;
			player2.bulletcooldown--;

			if(player.playerbounce(player2)){

				player.jumping = true;
				player2.jumping = true;
				player.grav = player.jumpSpd*1.3;

				player2.health-=5;

				//make sure player.jumping is set back to false
				setTimeout(function(){

					player.jumping = false;
					player2.jumping = false;

				}, 100);

			}

			if(player2.playerbounce(player)){

				player2.jumping = true;
				player.jumping = true;
				player2.grav = player2.jumpSpd*1.3;

				player.health-=5;

				//make sure player.jumping is set back to false
				setTimeout(function(){

					player2.jumping = false;
					player.jumping = false;

				}, 100);

			}

			for(pl=0;pl<platforms.length;pl++){

				platforms[pl].draw();

			}

			if(player.y > stage.canvas.height+100){

				player.x = 100+Math.random()*800;
				player.y = -100;

				player.grav = 0;
				player.yv = 0;
				player.xv = 0;

				player.health-=10;

			}

			if(player2.y > stage.canvas.height+100){

				player2.x = 100+Math.random()*800;
				player2.y = -100;

				player2.grav = 0;
				player2.yv = 0;
				player2.xv = 0;

				player2.health-=10;

			}

			//console.log(player.platformCollision(platform));

			if(player.platformCollision(platforms[0]) || player.platformCollision(platforms[1]) || player.platformCollision(platforms[2]) || player.platformCollision(platforms[3])){

				player.touchingground = true;

			} else {

				player.touchingground = false;

			}

			if(player2.platformCollision(platforms[0]) || player2.platformCollision(platforms[1]) || player2.platformCollision(platforms[2]) || player2.platformCollision(platforms[3])){

				player2.touchingground = true;

			} else {

				player2.touchingground = false;

			}

			for(bu=0;bu<bullets.length;bu++){

				bullets[bu].draw();
				bullets[bu].update();

				if(bullets[bu].x > stage.canvas.width+100 || bullets[bu].x < -100){

					bullets.splice(bu, 1);
					return;

				}

				if(bullets[bu].collision(player).name == 'player' && restarting == false){

					player.xv = bullets[bu].dir*3;
					player.health-=10;
					bullets.splice(bu, 1);
					return;

				}

				if(bullets[bu].collision(player2).name == 'player2' && restarting == false){

					player2.xv = bullets[bu].dir*3;
					player2.health-=10;
					bullets.splice(bu, 1);
					return;

				}

			}


		}
		setInterval(update, 0);

		document.addEventListener('keydown', function(event){
			pressingakey = true;
			if(event.key == 'd' || event.key == 'a'){

				player.xv = ((event.key == 'd') - (event.key == 'a'))*player.spd;
				player.holdingdir = true;
			}

			if(event.key == ' ' && player.touchingground){

				player.jumping = true;
				player.grav = player.jumpSpd;

				//make sure player.jumping is set back to false
				setTimeout(function(){

					player.jumping = false;

				}, 100);

			}

			if(event.key == 'd'){

				player.dir = 1;

			} else if(event.key == 'a'){

				player.dir = -1;

			}

			if(event.key == 's' && player.touchingground){

				player.jumping = true;

				setTimeout(function(){

					player.jumping = false;

				}, 100);

			}

			if(event.key == 'f' && player.bulletcooldown < 0 && player.reloading == false){

				bullets.push(new bulletConstructor(player.gunx,player.guny,player.dir,'player2'));
				player.bulletcooldown = player.bulletcooldowntime;

				if(player.ammo > 0){player.ammo--};

			}

			//player 2

			if(event.key == 'l' || event.key == 'j'){

				player2.xv = ((event.key == 'l') - (event.key == 'j'))*player2.spd;
				player2.holdingdir = true;
			}

			if(event.key == 'Enter' && player2.touchingground){

				player2.jumping = true;
				player2.grav = player2.jumpSpd;

				//make sure player.jumping is set back to false
				setTimeout(function(){

					player2.jumping = false;

				}, 100);

			}

			if(event.key == 'l'){

				player2.dir = 1;

			} else if(event.key == 'j'){

				player2.dir = -1;

			}

			if(event.key == 'k' && player2.touchingground){

				player2.jumping = true;

				setTimeout(function(){

					player2.jumping = false;

				}, 100);

			}

			if(event.key == "'" && player2.bulletcooldown < 0 && player2.reloading == false){

				bullets.push(new bulletConstructor(player2.gunx,player2.guny,player2.dir,'player'));
				player2.bulletcooldown = player2.bulletcooldowntime;

				if(player2.ammo > 0){player2.ammo--};

			}

		});

		document.addEventListener('keyup', function(event){
			pressingakey = false;
			if(event.key == 'd' && player.xv > 0){

				//player.xv = 0;
				player.holdingdir = false;

			}

			if(event.key == 'a' && player.xv < 0){

				//player.xv = 0;
				player.holdingdir = false;

			}

			if(event.key == 'l' && player2.xv > 0){

				player2.holdingdir = false;

			}

			if(event.key == 'j' && player2.xv < 0){

				//player.xv = 0;
				player2.holdingdir = false;

			}

		});

		function restartGame(){


			player.health = 100;
			player2.health = 100;

			player.x = 100+Math.random()*800;
			player.y = 0;

			player2.x = 100+Math.random()*800;
			player2.y = 0;

			player.ammo = 10;
			player2.ammo = 10;

			restarting = false;


		}
	</script>
</body>
</html>